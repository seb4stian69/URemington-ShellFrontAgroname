<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>AgroÑame - Vendedores</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-color: #eef4ed;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .navbar {
      background-color: #3d704d;
      color: white;
      font-weight: bold;
    }

    .navbar a {
      color: white;
      margin-right: 15px;
      text-decoration: none;
    }

    .product-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      background-color: #fff;
    }

    .product-card img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 10px;
    }

    .product-details {
      padding: 10px 0;
    }

    .product-actions button {
      margin-right: 5px;
    }

    .btn-primary {
      background-color: #388e3c;
      border-color: #2e7d32;
    }

    .btn-info {
      background-color: #66bb6a;
    }

    .btn-danger {
      background-color: #c62828;
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar p-3 mb-4 d-flex justify-content-between">
    <div>AgroÑame - Vendedores</div>
    <div>
      <a href="vendedores.html">Vendedores</a>
      <a href="compradores.html">Compradores</a>
    </div>
  </nav>

  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4>Mis Productos</h4>
      <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modalProducto" onclick="abrirModalNuevo()">+ Nuevo Producto</button>
    </div>

    <div class="row" id="productosContainer">
      <!-- Productos se cargarán aquí -->
    </div>
  </div>

  <!-- Modal: Producto -->
  <div class="modal fade" id="modalProducto" tabindex="-1" role="dialog" aria-labelledby="modalProductoLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form id="formProducto">
          <div class="modal-header">
            <h5 class="modal-title" id="modalProductoLabel">Agregar / Editar Producto</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="productoId">
            <div class="form-group">
              <label>Nombre del Producto</label>
              <input type="text" class="form-control" id="nombre" required>
            </div>
            <div class="form-group">
              <label>Precio Base</label>
              <input type="number" class="form-control" id="precio" required>
            </div>
            <div class="form-group">
              <label>Unidad de Medida</label>
              <input type="text" class="form-control" id="unidad" required>
            </div>
            <div class="form-group">
              <label>Subir Foto desde el Dispositivo</label>
              <input type="file" class="form-control-file" id="fotoArchivo" accept="image/*" onchange="mostrarPreview(this)">
            </div>
            <div class="form-group">
              <label>O Ingresar URL de la Foto</label>
              <input type="text" class="form-control" id="fotoURL" oninput="mostrarPreviewURL(this.value)">
            </div>
            <div class="form-group text-center">
              <img id="previewImagen" src="" alt="Vista previa" style="max-width: 100%; max-height: 200px; display: none; border-radius: 10px;">
            </div>
            <div class="form-group">
              <label>Prácticas de Cultivo</label>
              <textarea class="form-control" id="practicas" rows="3" required></textarea>
            </div>
            <div class="form-group">
              <label>Disponibilidad</label>
              <input type="number" class="form-control" id="disponibilidad" required>
            </div>
            <div class="form-group">
              <label>Porcentaje de Descuento</label>
              <input type="number" class="form-control" id="descuento" step="0.1" required>
            </div>
            <div class="form-group">
              <label>Categoría</label>
              <select class="form-control" id="categoria" required>
                <option value="Tubérculos">Tubérculos</option>
                <option value="Frutas">Frutas</option>
                <option value="Verduras">Verduras</option>
              </select>
            </div>
            <div class="form-group">
              <label>ID del Productor</label>
              <input type="number" class="form-control" id="productor" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar Producto</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bootstrap y JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let productos = [
      {
        id: 1,
        nombre: "Ñame criollo",
        precio: 3500.00,
        unidad: "kg",
        foto: "https://cdn.sitio.com/imagenes/ñame1.jpg",
        practicas: "Agricultura orgánica sin pesticidas",
        disponibilidad: 50,
        descuento: 10.0,
        categoria: "Tubérculos",
        productor: 1001
      }
    ];

    let editandoId = null;
    let fotoSeleccionada = productos[0].foto;

    document.addEventListener('DOMContentLoaded', () => {
      renderizarProductos();
    });

    function abrirModalNuevo() {
      document.getElementById('formProducto').reset();
      document.getElementById('productoId').value = '';
      document.getElementById('previewImagen').style.display = 'none';
      fotoSeleccionada = '';
      editandoId = null;
    }

    function mostrarPreview(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('previewImagen').src = e.target.result;
          document.getElementById('previewImagen').style.display = 'block';
          fotoSeleccionada = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
      }
    }

    function mostrarPreviewURL(url) {
      if (url.trim() !== '') {
        document.getElementById('previewImagen').src = url;
        document.getElementById('previewImagen').style.display = 'block';
        fotoSeleccionada = url;
      } else {
        document.getElementById('previewImagen').style.display = 'none';
        fotoSeleccionada = '';
      }
    }

    document.getElementById('formProducto').addEventListener('submit', function (e) {
      e.preventDefault();

      const nombre = document.getElementById('nombre').value;
      const precio = document.getElementById('precio').value;
      const unidad = document.getElementById('unidad').value;
      const practicas = document.getElementById('practicas').value;
      const disponibilidad = document.getElementById('disponibilidad').value;
      const descuento = document.getElementById('descuento').value;
      const categoria = document.getElementById('categoria').value;
      const productor = document.getElementById('productor').value;

      if (editandoId === null) {
        const nuevo = {
          id: productos.length + 1,
          nombre,
          precio,
          unidad,
          foto: fotoSeleccionada,
          practicas,
          disponibilidad,
          descuento,
          categoria,
          productor
        };
        productos.push(nuevo);
      } else {
        const idx = productos.findIndex(p => p.id === editandoId);
        productos[idx] = { id: editandoId, nombre, precio, unidad, foto: fotoSeleccionada, practicas, disponibilidad, descuento, categoria, productor };
        editandoId = null;
      }

      renderizarProductos();
      $('#modalProducto').modal('hide');
    });

    function renderizarProductos() {
      const container = document.getElementById('productosContainer');
      container.innerHTML = '';

      productos.forEach(p => {
        const card = document.createElement('div');
        card.className = 'col-md-4';
        card.innerHTML = `
          <div class="product-card">
            <img src="${p.foto}" alt="${p.nombre}">
            <div class="product-details">
              <h5>${p.nombre}</h5>
              <p><strong>Precio:</strong> $${p.precio} por ${p.unidad}</p>
              <p><strong>Disponibilidad:</strong> ${p.disponibilidad} unidades</p>
              <p><strong>Descuento:</strong> ${p.descuento}%</p>
              <p><strong>Categoría:</strong> ${p.categoria}</p>
              <p><strong>Prácticas:</strong> ${p.practicas}</p>
              <p><strong>ID Productor:</strong> ${p.productor}</p>
            </div>
            <div class="product-actions">
              <button class="btn btn-info btn-sm" onclick="editarProducto(${p.id})">Editar</button>
              <button class="btn btn-danger btn-sm" onclick="eliminarProducto(${p.id})">Eliminar</button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function editarProducto(id) {
      const p = productos.find(x => x.id === id);
      editandoId = id;

      document.getElementById('productoId').value = p.id;
      document.getElementById('nombre').value = p.nombre;
      document.getElementById('precio').value = p.precio;
      document.getElementById('unidad').value = p.unidad;
      document.getElementById('practicas').value = p.practicas;
      document.getElementById('disponibilidad').value = p.disponibilidad;
      document.getElementById('descuento').value = p.descuento;
      document.getElementById('categoria').value = p.categoria;
      document.getElementById('productor').value = p.productor;

      document.getElementById('previewImagen').src = p.foto;
      document.getElementById('previewImagen').style.display = 'block';
      fotoSeleccionada = p.foto;

      $('#modalProducto').modal('show');
    }

    function eliminarProducto(id) {
      productos = productos.filter(p => p.id !== id);
      renderizarProductos();
    }
  </script>

</body>

</html>


